# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Tree-sitter grammar for Luna-lang, a Lisp-like functional programming language. The grammar enables syntax highlighting, code folding, and structural editing across editors (Neovim, Emacs, VS Code).

## Commands

**With devenv (recommended):**

```bash
direnv allow          # Enter dev environment
generate              # Generate parser from grammar.js
test                  # Run all grammar tests
parse examples/sample.luna    # Parse a file
highlight examples/sample.luna  # Highlight a file
```

**With npm:**

```bash
npm install
npx tree-sitter generate
npx tree-sitter test
```

## Architecture

- `grammar.js` - Main grammar definition. Defines all Luna syntax rules (lists, vectors, maps, strings with interpolation, keywords, symbols, quoting).
- `src/parser.c` - Generated C parser (regenerated by `tree-sitter generate`)
- `queries/luna/highlights.scm` - Syntax highlighting rules using Tree-sitter query patterns
- `queries/luna/locals.scm` - Scope analysis for go-to-definition
- `queries/luna/folds.scm` - Code folding patterns
- `test/corpus/*.txt` - Test cases in Tree-sitter's test format

## Development Workflow

1. Edit `grammar.js` to modify syntax rules
1. Run `generate` to regenerate the parser
1. Run `test` to verify changes
1. Update `queries/luna/highlights.scm` if adding new node types

## Luna Syntax Quick Reference

| Construct | Example |
|-----------|---------|
| Lists | `(func arg1 arg2)` |
| Vectors | `[1 2 3]` |
| Maps | `{:key "value"}` |
| Keywords | `:keyword` |
| Symbols | `foo`, `namespace/symbol` |
| String interpolation | `"hello ${name}"`, `"result: $(+ 1 2)"` |
| Quote/Quasiquote | `'expr`, `` `(~unquote ~@splice) `` |
| Special forms | `def`, `defmacro`, `fn`, `if`, `let`, `do`, `match`, `ns` |
